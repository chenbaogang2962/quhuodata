- fetch_dataset:
    dataset_type_code: clear_warning_city_mini
    dataset_cate: std
    ignore_null_error: true

- run_py:
    - |
      df = to_df(df)
      df['col_val_dict'] = '0'
      df['col_val_dict'] = [u'[{"name":"%s","level":"%s","dc_list":"%s"},{"name":"%s","level":"%s","dc_list":"%s"},{"name":"%s","level":"%s","dc_list":"%s"},{"name":"%s","level":"%s","dc_list":"%s"}]' % (a,b,c,d,e,f,g,h,i,j,k,l) for a,b,c,d,e,f,g,h,i,j,k,l in  df[['evaluate_one','evaluate_one_level','evaluate_one_dc_list','evaluate_two','evaluate_two_level','evaluate_two_dc_list','evaluate_three','evaluate_three_level','evaluate_three_dc_list','evaluate_four','evaluate_four_level','evaluate_four_dc_list']].to_dict(orient='split')['data'] ]
      result = df
- fetch_cols:
    columns: [coach_team_name,col_val_dict]
- add_cols:
    - dimension: 'C'
- stash_push_df: []
- fetch_dataset:
    dataset_type_code: ele_day_60_dc_std
    dataset_cate: std
    ignore_null_error: true
    columns: [supplier_id,城市]
- df_rename_columns:
    - 城市: coach_team_name
- drop_duplicates:
    subset: [supplier_id,coach_team_name]
- stash_push_df: []
- stash_join_df:
    on: [coach_team_name]
    how: right
    drop_stash: true
- push_dataset:
    key: clear_warning_coach

- fetch_dataset:
    dataset_type_code: clear_warning_city_mini
    dataset_cate: std
    ignore_null_error: clear_warning_dc
- fetch_cols:
    columns: [coach_team_name,col_val_dict,vendor_dc_id]
- add_cols:
    - dimension: 'D'
- stash_push_df: []
- fetch_dataset:
    dataset_type_code: clear_warning_city_mini
    dataset_cate: std
    ignore_null_error: std_qplus_dc_copy
    columns: [supplier_id,vendor_dc_id]
- stash_push_df: []
- stash_join_df:
    on: [vendor_dc_id]
    how: inner
    drop_stash: true
- stash_push_df: []
- fetch_dataset:
    dataset_type_code: clear_warning_city_mini
    dataset_cate: std
    ignore_null_error: std_qplus_dc_copy
- fetch_dataset:
    dataset_type_code: clear_warning_city_mini
    dataset_cate: std
    key: std_qplus_dc_copy
- stash_push_df: []
- stash_concat_df:
    drop_stash: true
- set_meta_month_column:
    - book_month
- stash_push_df: []
- fetch_dataset:
    dataset_type_code: clear_warning_city_mini
    dataset_cate: std
    ignore_null_error: clean_warning_before
- stash_push_df: []

- stash_concat_df:
    drop_stash: true
